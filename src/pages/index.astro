---
import { blogEntries, blogEntryUrl } from '$lib/blog';

import Base from '$layouts/Base.astro';

import TagList from '$components/TagList.astro';
import Search from '$components/Search.astro';

import FormattedDate from '$components/FormattedDate.astro';

import '$styles/IndexPostList.css';

const posts = (await blogEntries()).sort(
  (a, b) => b.data.published.valueOf() - a.data.published.valueOf(),
);
---

<Base>
  <style slot="head">
    .posts.loading {
      display: none;
    }
    main.search-enabled {
      padding-top: 0;
    }
    /*  */
    @media (max-width: 600px) {
      .heading {
        display: flex;
        flex-direction: column;
      }
    }
  </style>
  <Search />
  <main class="search-enabled">
    <section>
      <ul class="accent block-list posts loading">
        {
          posts.map((post) => (
            <li data-article-id={post.id} data-article-meta={JSON.stringify(post.data)}>
              <a class="heading" href={blogEntryUrl(post)}>
                <h2>
                  <span class="title">{post.data.title}</span>
                </h2>
                <span class="date">
                  <FormattedDate date={post.data.published} />
                </span>
              </a>
              {post.data.tags && <TagList tags={post.data.tags} />}
              {post.data.description || ''}
            </li>
          ))
        }
      </ul>
      <script is:inline>
        if (!window.location.search) {
          document.querySelector('.posts').classList.remove('loading');
        }
      </script>
    </section>
  </main>
</Base>
